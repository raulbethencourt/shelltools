#!/bin/bash


in_path() {
  # Given a command and the PATH, tries to find the command. Returns 0 if
  #   found and executable; 1 if not. Note that this temporarily modifies
  #   the IFS (internal field separator) but restores it upon completion.
  cmd=$1
  ourpath=$2
  result=1
  oldIFS=$IFS
  IFS=":"

  for directory in $ourpath; do
    [ -x "$directory/$cmd" ] && result=0 # If we're here, we found the command.
  done

  IFS=$oldIFS
  return $result
}
checkForCmdInPath() {
  cmd=$1

  [ -n "$cmd" ] && {
    if [ "$(echo "$cmd" | cut -c1)" = "/" ]; then
      [ ! -x "$cmd" ] && return 1
    elif ! in_path "$cmd" "$PATH"; then
      return 2
    fi
  }
}
echon() {
  if checkForCmdInPath printf; then
    printf "%s" "$*"
  else
    echo "$*" | tr -d '\n'
  fi
}

getFileWithFzf() {
  file="$1"
  [ ! -f "$file" ] && [ ! -d "$file" ] && error_exit "$file is not a proper file or directory." 2

  FD=$(find "$file" -mindepth 1 -maxdepth 1 ! -name '.*')

  directory=$(
    echo "$FD" |
      sed -n '1p' |
      xargs -I {} dirname {}
  )
  file=$(
    echo "$FD" |
      xargs -I {} basename {} 2>/dev/null |
      fzf --bind=tab:up --bind=btab:down --bind=ctrl-g:first
  ) || exit 1
  [ -d "$directory/$file" ] && getFileWithFzf "$directory/$file/" || echo "$directory/$file"
}

getEnvFileFromPath() {
  envdir="$1"
  [ -z "$envdir" ] && error_exit "You must specify env directory."
  envfile=$(find "$envdir" -name ".env*")
  parentdir=$(dirname "$envdir")

  [ "$envdir" == "$HOME" ] && error_exit "You don't have any env file in your path."
  [ -z "$envfile" ] && getEnvFileFromPath "$parentdir" || echo "$envfile"
}
